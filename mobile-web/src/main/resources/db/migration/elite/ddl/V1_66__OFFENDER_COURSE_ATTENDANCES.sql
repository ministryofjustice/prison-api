CREATE TABLE OFFENDER_COURSE_ATTENDANCES
(
  EVENT_ID                        NUMBER(10)                          NOT NULL,
  OFFENDER_BOOK_ID                NUMBER(10)                          NOT NULL,
  EVENT_DATE                      DATE                                NOT NULL,
  START_TIME                      DATE,
  END_TIME                        DATE,
  EVENT_SUB_TYPE                  VARCHAR2(12)                        NOT NULL,
  EVENT_STATUS                    VARCHAR2(12)   DEFAULT 'SCH'        NOT NULL,
  COMMENT_TEXT                    VARCHAR2(4000),
  HIDDEN_COMMENT_TEXT             VARCHAR2(240),
  TO_INTERNAL_LOCATION_ID         NUMBER(10),
  CRS_SCH_ID                      NUMBER(10),
  OUTCOME_REASON_CODE             VARCHAR2(12),
  PIECE_WORK                      NUMBER(11,2),
  ENGAGEMENT_CODE                 VARCHAR2(12),
  UNDERSTANDING_CODE              VARCHAR2(12),
  DETAILS                         VARCHAR2(40),
  CREDITED_HOURS                  NUMBER(6,2),
  AGREED_TRAVEL_HOUR              NUMBER(6,2),
  SUPERVISOR_NAME                 VARCHAR2(30),
  BEHAVIOUR_CODE                  VARCHAR2(12),
  ACTION_CODE                     VARCHAR2(12),
  SICK_NOTE_RECEIVED_DATE         DATE,
  SICK_NOTE_EXPIRY_DATE           DATE,
  OFF_PRGREF_ID                   NUMBER(10),
  IN_TIME                         DATE,
  OUT_TIME                        DATE,
  PERFORMANCE_CODE                VARCHAR2(12),
  REFERENCE_ID                    NUMBER(20),
  TO_ADDRESS_OWNER_CLASS          VARCHAR2(12),
  TO_ADDRESS_ID                   NUMBER(10),
  EVENT_OUTCOME                   VARCHAR2(12),
  OFF_CRS_SCH_REF_ID              NUMBER(20),
  SUPERVISOR_STAFF_ID             NUMBER(10),
  CRS_APPT_ID                     NUMBER(20),
  OFFENDER_COURSE_APPT_RULE_ID    NUMBER(10),
  CRS_ACTY_ID                     NUMBER(10),
  EVENT_TYPE                      VARCHAR2(12)                        NOT NULL,
  AGY_LOC_ID                      VARCHAR2(6),
  EVENT_CLASS                     VARCHAR2(12)                        NOT NULL,
  UNEXCUSED_ABSENCE_FLAG          VARCHAR2(1),
  TO_AGY_LOC_ID                   VARCHAR2(6),
  SESSION_NO                      NUMBER(6),
  OFFENDER_PRG_OBLIGATION_ID      NUMBER(10),
  PROGRAM_ID                      NUMBER(10),
  BONUS_PAY                       NUMBER(11,3),
  TXN_ID                          NUMBER(10),
  TXN_ENTRY_SEQ                   NUMBER(6),
  PAY_FLAG                        VARCHAR2(1)    DEFAULT 'N',
  AUTHORISED_ABSENCE_FLAG         VARCHAR2(1)    DEFAULT 'N',
  SEAL_FLAG                       VARCHAR2(1),
  DIRECTION_CODE                  VARCHAR2(12),
  CREATE_DATETIME                 TIMESTAMP(9)   DEFAULT SYSTIMESTAMP NOT NULL,
  CREATE_USER_ID                  VARCHAR2(32)   DEFAULT USER      NOT NULL,
  MODIFY_DATETIME                 TIMESTAMP(9),
  MODIFY_USER_ID                  VARCHAR2(32),

  CONSTRAINT OFFENDER_COURSE_ATTENDANCES_PK PRIMARY KEY (EVENT_ID),

  CONSTRAINT OFF_CRS_ATTD_OFF_BKG_FK FOREIGN KEY (OFFENDER_BOOK_ID) REFERENCES OFFENDER_BOOKINGS(OFFENDER_BOOK_ID),
  CONSTRAINT OFF_CRS_ATTD_OFF_PRG_PROF_FK FOREIGN KEY (OFF_PRGREF_ID) REFERENCES OFFENDER_PROGRAM_PROFILES(OFF_PRGREF_ID),
  CONSTRAINT OFF_CRS_ATT_CRS_ACTY_FK FOREIGN KEY (CRS_ACTY_ID) REFERENCES COURSE_ACTIVITIES(CRS_ACTY_ID),
--   CONSTRAINT OFF_CRS_ATT_OFF_PRG_OB_FK FOREIGN KEY (OFFENDER_PRG_OBLIGATION_ID) REFERENCES OFFENDER_PRG_OBLIGATIONS,
  CONSTRAINT OFF_CRS_ATT_PRG_SERV_FK FOREIGN KEY (PROGRAM_ID) REFERENCES PROGRAM_SERVICES(PROGRAM_ID),

  CONSTRAINT OFFENDER_COURSE_ATTENDANCES_C1 CHECK (EVENT_CLASS IN ('INT_MOV','COMM','EXT_MOV'))
);


--ALTER TABLE OFFENDER_COURSE_ATTENDANCES ADD FOREIGN KEY (TXN_ID, TXN_ENTRY_SEQ) REFERENCES OFFENDER_TRANSACTIONS;


