-- Update SENTENCE_CALC_TYPES with recall eligibility and classification

-- Standard Determinate Sentences (recallable, STANDARD classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'Y', SENTENCE_CLASSIFICATION = 'STANDARD'
WHERE SENTENCE_CALC_TYPE IN ('ADIMP', 'ADIMP_ORA', 'YOI', 'YOI_ORA', 'SEC91', 'SEC91_03', 
                             'SEC250', 'SEC250_ORA', 'SEC236A', 'SOPC18', 'SOPC21');

-- Extended Sentences (recallable, EXTENDED classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'Y', SENTENCE_CLASSIFICATION = 'EXTENDED'
WHERE SENTENCE_CALC_TYPE IN ('CUR', 'CUR_ORA', 'EXT', 'EXT_ORA', 'SEC266', 'SDOPD', 'EDOPD');

-- Life and Indeterminate Sentences (recallable, INDETERMINATE classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'Y', SENTENCE_CLASSIFICATION = 'INDETERMINATE'
WHERE SENTENCE_CALC_TYPE IN ('LIFE', 'IPP', 'DPP', 'DLP', 'ALP', 'HMPL', 'MLP');

-- Recall Sentences (recallable, RECALL classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'Y', SENTENCE_CLASSIFICATION = 'RECALL'
WHERE SENTENCE_CALC_TYPE IN ('LR', 'LR_ORA', 'LR_YOI', 'LR_YOI_ORA', 'LR_EXT', 'LR_EXT_ORA',
                             'FTR', 'FTR_ORA', '14FTR_ORA', 'FTR_14_ORA', 'FTR_SCH15', 
                             'FTRSCH15_ORA', 'FTRSCH18', 'FTRSCH18_ORA', 'HDR', 'HDR_ORA',
                             'HDCR', 'CUR_REC', 'EXT_REC');

-- Detention and Training Orders (recallable, DTO classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'Y', SENTENCE_CLASSIFICATION = 'DTO'
WHERE SENTENCE_CALC_TYPE IN ('DTO', 'DTO_ORA');

-- Fine sentences (not recallable, FINE classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'N', SENTENCE_CLASSIFICATION = 'FINE'
WHERE SENTENCE_CALC_TYPE IN ('A/FINE', 'A_FINE', 'FINE');

-- License-only sentences (generally not recallable, OTHER classification)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'N', SENTENCE_CLASSIFICATION = 'OTHER'
WHERE SENTENCE_CATEGORY = 'LICENCE' AND IS_RECALLABLE IS NULL;

-- Update remaining unmapped types to OTHER (default not recallable)
UPDATE SENTENCE_CALC_TYPES 
SET IS_RECALLABLE = 'N', SENTENCE_CLASSIFICATION = 'OTHER'
WHERE SENTENCE_CLASSIFICATION IS NULL;

-- Populate OFFENDER_SENTENCES from the lookup table
UPDATE OFFENDER_SENTENCES os
SET (IS_RECALLABLE, SENTENCE_CLASSIFICATION) = (
    SELECT sct.IS_RECALLABLE, sct.SENTENCE_CLASSIFICATION
    FROM SENTENCE_CALC_TYPES sct
    WHERE os.SENTENCE_CALC_TYPE = sct.SENTENCE_CALC_TYPE
    AND os.SENTENCE_CATEGORY = sct.SENTENCE_CATEGORY
)
WHERE EXISTS (
    SELECT 1 
    FROM SENTENCE_CALC_TYPES sct
    WHERE os.SENTENCE_CALC_TYPE = sct.SENTENCE_CALC_TYPE
    AND os.SENTENCE_CATEGORY = sct.SENTENCE_CATEGORY
);

COMMIT;